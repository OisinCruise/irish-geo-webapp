# Render Deployment Checklist

## Pre-Deployment

- [x] Database migrated from Neon to Render PostgreSQL
- [x] `render.yaml` configured with database and web service
- [x] `production.py` settings updated for Render PostgreSQL
- [ ] Code pushed to GitHub

## Deployment Steps

### If Using Blueprint (Recommended)

1. [ ] Push updated code to GitHub
2. [ ] Go to Render Dashboard → New → Blueprint
3. [ ] Connect GitHub repository
4. [ ] Render auto-detects `render.yaml`
5. [ ] Review and confirm service configuration
6. [ ] Deploy

### If Manually Linking Existing Services

1. [ ] Go to Render Dashboard → Your Database (`irish-geo-db`)
2. [ ] Copy "Internal Database URL" from Info tab
3. [ ] Go to Your Web Service (`irish-geo-webapp`)
4. [ ] Environment tab → Add/Update `DATABASE_URL`
5. [ ] Paste the Internal Database URL
6. [ ] Save and redeploy

## Post-Deployment Verification

### 1. Check Service Status
- [ ] Database service is "Available"
- [ ] Web service is "Live"
- [ ] No error messages in logs

### 2. Test Database Connection
- [ ] Web service logs show successful database connection
- [ ] No "connection refused" or "authentication failed" errors

### 3. Test API Endpoints
- [ ] `/api/health/` returns 200 OK
- [ ] `/api/v1/sites/` returns data (not empty)
- [ ] `/api/v1/counties/` returns data
- [ ] `/api/v1/provinces/` returns data

### 4. Test Application Features
- [ ] Home page loads correctly
- [ ] Map page (`/explore/`) loads and shows sites
- [ ] Site markers appear on map
- [ ] Site popups work
- [ ] Bucket list functionality works
- [ ] Admin panel accessible (if configured)

### 5. Verify Data
```bash
# Check via Render Shell or local psql
psql "YOUR_RENDER_DATABASE_URL" -c "SELECT COUNT(*) FROM historical_site;"
psql "YOUR_RENDER_DATABASE_URL" -c "SELECT COUNT(*) FROM county;"
```

## Troubleshooting

### Database Connection Issues

**Error: "could not connect to server"**
- Check database service is running
- Verify `DATABASE_URL` is set correctly
- Check if using Internal Database URL (for Render services)

**Error: "authentication failed"**
- Verify database credentials
- Check if database user has correct permissions

**Error: "PostGIS extension not found"**
- PostGIS should already be enabled from migration
- Verify: `psql "DATABASE_URL" -c "SELECT PostGIS_version();"`

### Application Issues

**Error: "No data returned"**
- Verify data was migrated successfully
- Check table counts match Neon database
- Verify filters aren't excluding all data

**Error: "Static files not found"**
- Check `collectstatic` ran during build
- Verify WhiteNoise is configured correctly

## Environment Variables Reference

### Required (Auto-provided by Render)
- `DATABASE_URL` - Automatically linked from database service

### Required (Manual)
- `DJANGO_SECRET_KEY` - Auto-generated by Render
- `DJANGO_ALLOWED_HOSTS` - Set to `.onrender.com`
- `DJANGO_SETTINGS_MODULE` - Set to `config.settings.production`

### Optional
- `CORS_ALLOWED_ORIGINS` - For CORS configuration
- `CUSTOM_DOMAIN` - If using custom domain

## Rollback Plan

If issues occur:

1. **Keep Neon database** as backup (don't delete yet)
2. **Temporarily switch back** by updating `DATABASE_URL` to Neon connection string
3. **Fix issues** and redeploy
4. **Switch back** to Render PostgreSQL once stable

## Support Resources

- Render Dashboard: https://dashboard.render.com
- Render Docs: https://render.com/docs
- Render Status: https://status.render.com

---

**Last Updated:** December 2025

